<ng-container *ngIf="dataset$ | async as dataset">
  <ng-container *ngIf="fields; else noFields">
    <form [formGroup]="form">

      <ion-item-group *ngIf="fields.dateFields && fields.dateFields.length">
        <ion-item-divider color="secondary">
          <ion-label><fa-icon [icon]="farCalendar"></fa-icon>Dates</ion-label>
        </ion-item-divider>

        <ion-list>
          <ng-container *ngFor="let field of fields.dateFields">
            <app-date-field [formGroup]="form" [field]="field" [readonly]="readonly"></app-date-field>
          </ng-container>
        </ion-list>
      </ion-item-group>

      <ion-item-group *ngIf="fields.locationFields && fields.locationFields.length">
        <ion-item-divider color="secondary">
          <ion-label><fa-icon [icon]="faLocationArrow"></fa-icon><app-location-selector [formGroup]="form" [readonly]="readonly"/></ion-label>
        </ion-item-divider>

        <ion-list>
          <ng-container *ngFor="let field of fields.locationFields">
            <app-field [formGroup]="form" [field]="field" [readonly]="readonly"/>
          </ng-container>
        </ion-list>
      </ion-item-group>

      <ion-item-group *ngIf="fields.requiredFields && fields.requiredFields.length">
        <ion-item-divider color="secondary">
          <ion-label><fa-icon [icon]="faStar"></fa-icon>Required fields</ion-label>
        </ion-item-divider>

        <ion-list>
          <ng-container *ngFor="let field of fields.requiredFields">
            <app-field [formGroup]="form" [field]="field" [readonly]="readonly"/>
          </ng-container>
        </ion-list>
      </ion-item-group>

      <ion-item-group *ngIf="fields.optionalFields && fields.optionalFields.length">
        <ion-item-divider color="secondary">
          <ion-label><fa-icon [icon]="farStar"></fa-icon>Optional fields</ion-label>
        </ion-item-divider>

        <ion-list>
          <ng-container *ngFor="let field of fields.optionalFields">
            <app-field [formGroup]="form" [field]="field" [readonly]="readonly"/>
          </ng-container>
        </ion-list>
      </ion-item-group>

      <app-hidden-field *ngFor="let field of fields.hiddenFields"
                        [formGroup]="form"
                        [field]="field"
                        [readonly]="readonly"/>

    </form>

  </ng-container>

  <ng-template #noFields>
    There are no fields defined as part of the dataset.
  </ng-template>
</ng-container>
